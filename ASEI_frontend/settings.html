<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Settings</title>
<script>
  tailwind.config = { darkMode: 'class' };
</script>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="icon" type="image/png" href="images/connectify_logo.png">
</head>
<body class="bg-neutral-100 text-neutral-900 dark:bg-gray-900">


  <!-- Sidebar -->
    <aside class="fixed inset-y-0 left-0 w-60 bg-neutral-900 text-neutral-100 flex flex-col">
      <div class="px-4 py-4 flex items-center gap-2 border-b border-neutral-800">
        <img src="images/connectify_logo.png" alt="Logo" class="h-8 w-auto">
        <span>Connectify</span>
      </div>

    <nav class="p-2 text-sm space-y-1 flex-1">
      <a href="asei_dashboard.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üè† <span class="hidden sm:inline">Dashboard</span></a>
      <a href="flow_designer.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üõ† <span class="hidden sm:inline">Flow Designer</span></a>
      <a href="connectors.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üîå <span class="hidden sm:inline">Connectors</span></a>
      <a href="templates.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üìë <span class="hidden sm:inline">Templates</span></a>
      <a href="deployments.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üöÄ <span class="hidden sm:inline">Deployments</span></a>
      <a href="monitoring.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üìä <span class="hidden sm:inline">Monitoring</span></a>
      <a href="settings.html" class="flex items-center gap-2 px-3 py-2 rounded bg-neutral-800">‚öôÔ∏è <span class="hidden sm:inline">Settings</span></a>
    </nav>

    <div class="relative">
      <button id="profileBtn" class="w-full px-4 py-4 flex items-center gap-2 border-t border-neutral-800 text-left hover:bg-neutral-800/60">

          <img id="initialSidebarPfp" src="images/default_avatar.png" class="js-initial-pfp h-8 w-8 rounded-full object-cover" alt="O Pfp"/>
          <img id="mainPfp" class="js-main-pfp h-8 w-8 rounded-full object-cover hidden" alt="N Pfp"/>
          <span class="text-sm font-medium">Insert User Name</span>
      </button>

      <div id="profileMenu" class="absolute hidden bottom-full left-3 left-3 right-3 mt-4 rounded-lg bg-neutral-800 border border-neutral-700 text-neutral-200 shadow-xl z-50">
          <button class="px-3 py-3 text-red-400 w-full hover:bg-neutral-700">Sign Out</button>
      </div>
    </div>
    <script>
      const btn = document.getElementById('profileBtn');
      const menu = document.getElementById('profileMenu');
      btn.addEventListener('click', (e) => {
          e.stopPropagation();
          menu.classList.toggle('hidden');
      });

      document.addEventListener('click', (e) =>{
          if(!menu.contains(e.target) && e.target !== btn){
              menu.classList.add('hidden');
          }
      });
    </script>
  </aside>


<main class="px-6 pt-0 ml-40 md:ml-64">
<h2 class="text-xl font-semibold mb-4">Settings</h2>

  <div class="bg-white p-6 rounded shadow space-y-6 max-w-2xl mx-auto">

    <!-- General -->
    <div>
      <div class="w-full px-4 py-4 flex items-center gap-2 border-neutral-800 text-left">
          <button id="pfpTrigger" class="group relative h-12 w-12 rounded-full border border-neutral-400 overflow-hidden cursor-pointer group" aria-label="Changing pfp">
          <img id="initialMainPfp" src="images/default_avatar.png" alt="avatar" class="js-initial-pfp absolute inset-0 h-full w-full bg-gray-300 transition-opacity duration-300 group-hover:opacity-0 group-hover:scale-110"/>
          <img id="hoverPfp" src="images/hover.png" alt="avatar" class="js-hover-pfp absolute inset-2 h-8 w-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100"/>
          
          <img id="mainPfp" class="js-main-pfp absolute inset-0 h-12 w-12 rounded-full object-cover hidden" alt="Pfp"/>
          </button>
          <span class="font-bold mb-0">Insert User Name</span>
          <input type="file" id="updatePfp" accept="image/*" class="hidden">
      </div>
      

<div class="flex-grow border-t border-gray-400 mb-2"></div>
      <div class="flex items-center w-full mb-2">
        <h3 class="font-semibold mb-2">Update Profile</h3>
        <button id="editBtn" class="ml-auto px-4 py-1 bg-blue-500 hover:bg-blue-600 rounded-full">
          <label class="text-sm font-small text-white">Edit</label>
        </button>
        <button id="cancelBtn" class="hidden ml-2 px-4 py-1 bg-gray-400 hover:bg-gray-500 rounded-full">
          <label class="text-sm font-small text-white">Cancel</label>
        </button>
      </div>
      <div>
        <div>
          <label class="block text-sm font-medium">Given Names</label>
          <p id="viewFName" class="rounded px-3 py-1 w-full mb-2">asd</p>
          <input id="editFName" type="text" class="hidden border rounded px-3 py-2 w-full lg:w-1/2 mb-4">
        </div>

        <div>
          <label class="block text-sm font-medium"> Surname</label>
          <p id="viewLName" class="rounded px-3 py-1 w-full mb-2">asd</p>
          <input id="editLName" type="text" class="hidden border rounded px-3 py-2 w-full lg:w-1/2 mb-4">
        </div>

        <div>
          <label class="block text-sm font-medium">Email</label>
          <p id="viewEmail" class="rounded px-3 py-1 w-full mb-2">asd</p>
          <input id="editEmail" type="text" class="hidden border rounded px-3 py-2 w-full lg:w-1/2 mb-4">
        </div>

        <div class="hidden">
          <label class="block text-sm font-medium">Change Password</label>
          <input id="changePassword" type="text" class="border rounded px-3 py-2 w-full lg:w-1/2 mb-4">
        </div>

        <div class="hidden">
          <label class="block text-sm font-medium text-red-400">*Enter old password to confirm</label>
          <input type="password" id="confirmPassword" name="confirmPassword" class="border rounded px-3 py-2 w-full lg:w-1/2 mb-4">
        </div>
      </div>

<div class="flex-grow border-t border-gray-400 mb-2 mt-2"></div>

        <div class="flex flex-col">
          <label for="Theme" class="font-semibold mb-2">Theme</label>
            <select id="Theme" class="border rounded px-3 py-2 w-full sm:w-48">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
        </div>
<div class="flex-grow border-t border-gray-400 mb-2 mt-2"></div>

        <div>
          <h3 class="font-semibold mb-2">Security</h3>
          <label class="flex items-center space-x-2">
            <input type="checkbox" class="form-checkbox"> <span>Allow IP Whitelist Only</span>
          </label>
        </div>
<div class="flex-grow border-t border-gray-400 mb-2 mt-2"></div>

        <div>
          <h3 class="font-semibold mb-2">Notifications</h3>
          <label class="flex items-center space-x-2">
            <input type="checkbox" checked class="form-checkbox"> <span>Send error alerts</span>
          </label>
        </div>
<div class="flex-grow border-t border-gray-400 mb-2 mt-2"></div>

          <div>
            <h3 class="font-semibold mb-2">Advance Settings</h3>
            <label class="block text-sm font-medium">API Rate Limit</label>
              <input type="number" value="1000" class="border rounded px-3 py-2 w-full sm:w-48 mb-4">
          </div>
<div class="flex-grow border-t border-gray-400 mb-2 mt-2"></div>

    <div class="flex space-x-3">
      <button id="saveEdit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">Save Changes</button>
      <button id="resetEdit" class="px-4 py-2 bg-gray-400 hover:bg-gray-500 text-white rounded">Reset</button>
    </div>

</main>
<!-- Edit profile -->
  <script>
    /*const firstName = document.getElementById('first-name');
    const lastName = document.getElementById('last-name');
    const email = document.getElementById('email');
    const enterPass = document.getElementById('enter-password');

    function toggleCP() {
      const show = firstName.value.trim() || lastName.value.trim() || email.value.trim();
      enterPass.classList.toggle('hidden', !show);
    }
    [firstName, lastName, email].forEach(input =>
      input.addEventListener('input', toggleCP)
    );*/

    const editBtn = document.getElementById('editBtn');
    const editBtnLabel = editBtn.querySelector('label');
    const cancelBtn = document.getElementById('cancelBtn');
    const viewFName = document.getElementById('viewFName');
    const editFName = document.getElementById('editFName');
    const viewLName = document.getElementById('viewLName');
    const editLName = document.getElementById('editLName');
    const viewEmail = document.getElementById('viewEmail');
    const editEmail = document.getElementById('editEmail');
    const changePassword = document.getElementById('changePassword');
    const confirmPassword = document.getElementById('confirmPassword');
    const wrapChangeP = changePassword.parentElement;
    const wrapConfirmP = confirmPassword.parentElement;
    const show = el => el.classList.remove('hidden');
    const hide = el => el.classList.add('hidden');

    let editing = false;

    function toggleEdit(){
      editFName.value = viewFName.textContent || '';
      editLName.value = viewLName.textContent || '';
      editEmail.value = viewEmail.textContent ||'';

      show(editFName); show(editLName); show(editEmail); show(wrapChangeP); show(cancelBtn);
      hide(viewFName); hide(viewLName); hide (viewEmail); hide(wrapConfirmP);

      editBtnLabel.textContent = 'Save';
      editing = true;
    }

    function editNSave(){
      viewFName.textContent = editFName.value.trim();
      viewLName.textContent = editLName.value.trim();
      viewEmail.textContent = editEmail.value.trim();

      show(viewFName); show(viewLName); show(viewEmail);
      hide(editFName); hide(editLName); hide(editEmail); hide(wrapChangeP); hide(wrapConfirmP); hide(cancelBtn);

      editBtnLabel.textContent = 'Edit';
      editing = false;
    }

    function toggleCP(){
      const showCP = editFName.value.trim() || editLName.value.trim() || editEmail.value.trim() || changePassword.value.trim();
      wrapConfirmP.classList.toggle('hidden', !showCP);
    }
    [editFName, editLName, editEmail, wrapChangeP].forEach(input =>
      input.addEventListener('input', toggleCP)
    );

    function cancel(){
      editFName.value = (viewFName.textContent || '').trim();
      editLName.value = (viewLName.textContent || '').trim();
      editEmail.value = (viewEmail.textContent || '').trim();
      changePassword.value = '';
      confirmPassword.value = '';

      show(viewFName); show(viewLName); show(viewEmail);
      hide(editFName); hide(editLName); hide(editEmail); hide(wrapChangeP); hide(wrapConfirmP); hide(cancelBtn);
      editBtnLabel.textContent = 'Edit';
      editing = false;
    }

    editBtn.addEventListener('click', () => {
      if(!editing){
        toggleEdit();
      }
      else{editNSave()};
    });

    cancelBtn.addEventListener('click', cancel);

  </script>

<!-- Update sidebar & setting Pfp -->
<script>
  const pfpTrigger = document.getElementById("pfpTrigger");
  const updatePfp = document.getElementById("updatePfp");
  const imageStore = "connectify.pfpUrl";

  if(pfpTrigger && updatePfp){
    pfpTrigger.addEventListener("click", () => updatePfp.click());
    updatePfp.addEventListener("change", (e) => {
      const file = e.target.files[0];

      if(!file){
        return;
      }

      if(!file.type.startsWith("image/")){
        alert("Please choose an image.");
        return;
      }
      const reader = new FileReader();
      reader.onload = () =>{
        const pfpUrl = reader.result;
        try{
          localStorage.setItem(imageStore, pfpUrl)
        }
        catch (e){
          console.warn("Could not save avatar. Try again.", e);
        }
        applyPfpToDOM(pfpUrl);
      };
      reader.readAsDataURL(file);
    });
  }
  function applyPfpToDOM(dataUrl){
    document.querySelectorAll(".js-main-pfp").forEach(img =>{
      img.src = dataUrl;
      img.classList.remove("hidden");
    });
    document.querySelectorAll(".js-initial-pfp, .js-hover-pfp").forEach(element =>{
      element.classList.add("hidden");
    });
  }
  function hydrate(){
    const saveImg = localStorage.getItem(imageStore);
    if(saveImg) applyPfpToDOM(saveImg);
  }
  document.addEventListener('DOMContentLoaded', hydrate);

</script>

<!-- Light Dark mode toggle -->
<script>
  /*
  function toggleDarkMode(mode){
    document.documentElement.classList.toggle('dark', mode == 'dark');
    if(document.documentElement.classList.contains('dark')){
      localStorage.setItem('theme', 'dark');
    }
    else{
      localStorage.setItem('theme', 'light');
    }
  }
  (function(){
    const storeTheme = localStorage.getItem('theme');
    if(storeTheme == 'dark'){
      document.documentElement.classList.add('dark');
    }
    else{
      document.documentElement.classList.remove('dark');
    }

    const syncDropdown = document.getElementById('Theme');
    if(syncDropdown) syncDropdown.value = mode;
  })();

  document.addEventListener('DOMContentLoaded', ()=>{
    const syncDropdown = document.getElementById('Theme');
    if(!syncDropdown) return;
    syncDropdown.addEventListener('change', (e) => toggleDarkMode(e.target.value));
  });*/

  const userTheme = localStorage.getItem('theme');
  const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches;
  const darkMode = document.getElementById('darkMode');
  const lightMode = document.getElementById('lightMode');
  const mode = 'hidden';
  const selectTheme = document.getElementById('Theme');

  const themeCheck = ()=> {
    if(userTheme === 'dark' || (!userTheme && systemTheme)){
      document.documentElement.classList.add('dark');
    }
    else if(!userTheme && systemTheme){
      document.documentElement.classList.add('dark');
    }
    else{
      document.documentElement.classList.remove('dark');
    }

    if(selectTheme){
      if(document.documentElement.classList.contains('dark')){
        selectTheme.value = 'dark';
      }
      else{
        selectTheme.value = 'light';
      }
    }
  }

  const themeSwitch = ()=> {
    if(document.documentElement.classList.contains('dark')){
      document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', 'light');
      return;
    }
    document.documentElement.classList.add('dark');
    localStorage.setItem('theme', 'dark');
  }
  themeCheck();
</script>

</body>
</html>