<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flow Designer</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/jsplumb@2.15.6/dist/js/jsplumb.min.js"></script>
<link rel="icon" type="image/png" href="images/connectify_logo.png">
<style>
  body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial; }

  #canvas {
    position: relative;
    width: 100%;
    height: 70vh;
    background-image:
      linear-gradient(to right, #e5e7eb 1px, transparent 1px),
      linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
    background-size: 40px 40px;
    border-radius: 0.5rem;
    overflow: hidden;
  }

  .node {
    position: absolute;
    padding: 10px 14px;
    border-radius: 10px;
    color: #fff;
    cursor: move;
    font-size: 0.875rem;
    user-select: none;
    box-shadow: 0 2px 8px rgba(0,0,0,.12);
    border: 2px solid transparent;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-width: 120px;
  }

  .node.start{background:#2563eb}
  .node.api{background:#16a34a}
  .node.condition{background:#eab308;color:#111}
  .node.transform{background:#8b5cf6}
  .node.end{background:#dc2626}
  .node.active{border-color:#3b82f6}

  .connector-dot {
    width: 10px;
    height: 10px;
    background-color: #1f2937;
    border-radius: 999px;
    cursor: crosshair;
  }
  .dot-left { margin-right: 8px; }
  .dot-right { margin-left: 8px; }
</style>
</head>

<body class="bg-neutral-100 text-neutral-900">

<!-- Sidebar -->
<aside class="fixed inset-y-0 left-0 w-60 bg-neutral-900 text-neutral-100 flex flex-col">
  <div class="px-4 py-4 flex items-center gap-2 border-b border-neutral-800">
    <img src="images/connectify_logo.png" alt="Logo" class="h-8 w-auto">
    <span>Connectify</span>
  </div>
  <nav class="p-2 text-sm space-y-1 flex-1">
    <a href="asei_dashboard.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üè† Dashboard</a>
    <a href="flow_designer.html" class="flex items-center gap-2 px-3 py-2 rounded bg-neutral-800">üõ† Flow Designer</a>
    <a href="connectors.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üîå Connectors</a>
    <a href="templates.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üìë Templates</a>
    <a href="deployments.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üöÄ Deployments</a>
    <a href="monitoring.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">üìä Monitoring</a>
    <a href="settings.html" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-neutral-800/70">‚öôÔ∏è Settings</a>
  </nav>
</aside>

<!-- Main -->
<main class="ml-60 p-6">
  <h2 class="text-xl font-semibold mb-4">Flow Designer</h2>

  <!-- Toolbar -->
  <div class="flex items-center justify-between mb-2">
    <div class="text-neutral-500 text-sm">Drag nodes onto the grid and connect them by dragging from the right dot to another node‚Äôs left dot.</div>
    <div class="flex gap-2">
      <button class="px-3 py-2 border rounded" onclick="exportFlow()">Export</button>
      <button class="px-3 py-2 bg-gray-600 text-white rounded" onclick="saveFlow('draft')">Save Draft</button>
      <button class="px-3 py-2 bg-blue-600 text-white rounded" onclick="saveFlow('deployed')">Deploy Flow</button>
    </div>
  </div>

  <div class="grid grid-cols-12 gap-4">
    <!-- Node Library -->
    <aside class="col-span-12 md:col-span-3 bg-white rounded shadow p-4 overflow-auto">
      <div class="text-sm font-semibold mb-3">Node Library</div>
      <div class="text-xs uppercase text-neutral-500 mb-2">General</div>
      <div class="space-y-2 mb-4">
        <button class="w-full border rounded px-2 py-2 text-left" onclick="createNode('start')">Start</button>
        <button class="w-full border rounded px-2 py-2 text-left" onclick="createNode('end')">End</button>
      </div>
      <div class="text-xs uppercase text-neutral-500 mb-2">MTN (Collections)</div>
      <div class="space-y-2">
        <button class="w-full border rounded px-2 py-2 text-left" onclick="createNode('mtn.requestToPay','api','MTN ‚Ä¢ Request to Pay')">MTN ‚Ä¢ Request to Pay</button>
        <button class="w-full border rounded px-2 py-2 text-left" onclick="createNode('mtn.checkStatus','api','MTN ‚Ä¢ Check Status')">MTN ‚Ä¢ Check Status</button>
        <button class="w-full border rounded px-2 py-2 text-left" onclick="createNode('mtn.getBalance','api','MTN ‚Ä¢ Get Balance')">MTN ‚Ä¢ Get Balance</button>
        <button class="w-full border rounded px-2 py-2 text-left" onclick="createNode('mtn.getAccountHolder','api','MTN ‚Ä¢ Account Holder')">MTN ‚Ä¢ Account Holder</button>
      </div>
      <div class="mt-6">
        <button class="w-full px-3 py-2 border rounded" onclick="clearCanvas()">Clear Canvas</button>
      </div>
    </aside>

    <!-- Canvas -->
    <section class="col-span-12 md:col-span-6">
      <div id="canvas" class="bg-white shadow"></div>
    </section>

    <!-- Properties -->
    <aside id="propertiesPanel" class="col-span-12 md:col-span-3 bg-white rounded shadow p-4 hidden">
      <h3 class="font-semibold mb-2">Node Properties</h3>
      <div id="propInner" class="space-y-3 text-sm">
        <p class="text-neutral-500">Select a node.</p>
      </div>
    </aside>
  </div>
</main>

<!-- JS Logic -->
<script>
let jsPlumbInstance;
let nodes = [];
let connections = [];
const canvas = document.getElementById('canvas');

document.addEventListener('DOMContentLoaded', () => {
  jsPlumbInstance = jsPlumb.getInstance({
    Container: canvas,
    Connector: ['Bezier', { curviness: 50 }],
    PaintStyle: { stroke: '#64748b', strokeWidth: 2 },
    EndpointStyle: { fill: '#1f2937', radius: 4 },
    Anchors: ['Right', 'Left'],
    ConnectionOverlays: [['Arrow', { width:10, length:10, location:1 }]]
  });

  canvas.addEventListener('click', () => {
    document.getElementById('propertiesPanel').classList.add('hidden');
  });
});

function createNode(type, kindOverride, nameOverride) {
  const id = 'node_' + Math.random().toString(36).substr(2, 9);
  const kind = kindOverride || (type.startsWith('mtn.') ? 'api' : type);
  const name = nameOverride || type[0].toUpperCase() + type.slice(1);

  const el = document.createElement('div');
  el.className = `node ${kind}`;
  el.id = id;
  el.style.left = (60 + Math.random()*300) + 'px';
  el.style.top = (40 + Math.random()*200) + 'px';
  el.innerHTML = `
    <div class="connector-dot dot-left" id="${id}_left"></div>
    <span>${name}</span>
    <div class="connector-dot dot-right" id="${id}_right"></div>
  `;
  canvas.appendChild(el);

  jsPlumbInstance.draggable(el, { grid:[10,10] });
  jsPlumbInstance.makeSource(document.getElementById(id+'_right'), { parent: el, anchor:'Right' });
  jsPlumbInstance.makeTarget(document.getElementById(id+'_left'), { parent: el, anchor:'Left' });

  el.addEventListener('click', (e)=>{
    e.stopPropagation();
    openProps(id, name);
  });

  nodes.push({id, type, kind, name, x:el.offsetLeft, y:el.offsetTop});
}

function openProps(id, name) {
  const panel = document.getElementById('propertiesPanel');
  const inner = document.getElementById('propInner');
  panel.classList.remove('hidden');
  inner.innerHTML = `
    <label class="block text-sm font-medium mb-1">Node Label</label>
    <input id="prop_name" class="w-full border rounded px-2 py-1 mb-3" value="${name}">
    <button class="px-3 py-2 border rounded" onclick="saveNodeLabel('${id}')">Save</button>
  `;
}

function saveNodeLabel(id) {
  const newName = document.getElementById('prop_name').value;
  const el = document.getElementById(id);
  if (el) el.querySelector('span').textContent = newName;
}

function exportFlow() {
  const connections = jsPlumbInstance.getAllConnections().map(c=>({from:c.sourceId,to:c.targetId}));
  console.log(JSON.stringify({nodes,connections}, null, 2));
  alert('Flow exported to console');
}

function saveFlow(status) {
  alert(status === 'draft' ? 'Draft saved!' : 'Flow deployed!');
}

function clearCanvas() {
  canvas.innerHTML = '';
  jsPlumbInstance.reset();
  nodes = [];
}
</script>
</body>
</html>



